# SPLENTA UI Batch 06: Custom Controls (Waveform & Split-Toggle)

你是 JUCE 自定义控件开发专家。Batch 05 系列已经统一了视觉风格，Batch 06 的目标是替换掉所有原生的、丑陋的 JUCE 控件（ComboBox, ToggleButton），替换为完全自定义绘制的图形化控件。

---

## 任务 1：自定义波形选择器 (Waveform Tray)

**目标**：替换 "Generator" 面板中的波形选择 ComboBox。
**设计**：
- **外观**：三个连在一起的圆角矩形（托盘状），类似于 Segmented Control。
- **内容**：不显示文字，而是绘制图形图标（Sine, Triangle, Square）。
- **颜色**：
  - 选中项：高亮显示。
  - **色系要求**：三个选项使用主题 Accent Color 的“邻近色” (Analogous Colors)。例如，如果主题是蓝色，三个按钮分别是 青蓝、正蓝、深蓝。可以使用 `colour.withRotatedHue(float)` 来生成。
- **交互**：点击对应区域切换参数。

**技术实现建议**：
- 创建新组件 `WaveformSelectorComponent`。
- 成员变量：`Attachment` (连接到波形选择参数)。
- `paint` 方法：使用 `juce::Path` 绘制正弦线、三角形轮廓、正方形轮廓。

---

## 任务 2：斜切双控开关 (Split Dual Toggle)

**目标**：将 "Auto Gain" 和 "Soft Clip" 两个开关合并为一个紧凑的方形控件，并移动到 "Master Output" 面板内。
**设计**：
- **外观**：一个正方形，中间有一条从**左下角到右上角**（或左上到右下，根据用户要求：左上半部 AutoGain，右下半部 SoftClip）的斜线，将方块一分为二。
- **状态颜色**：
  - **左上三角形 (Auto Gain)**：激活时填充 Theme Color A，未激活暗淡。
  - **右下三角形 (Soft Clip)**：激活时填充 Theme Color B (稍微错开一点色相)，未激活暗淡。
- **交互**：
  - 点击左上区域 -> 切换 Auto Gain。
  - 点击右下区域 -> 切换 Soft Clip。
  - 需要在 `mouseDown` 中进行坐标几何判定（`y < x` 或类似逻辑，取决于斜线方向）。

**技术实现建议**：
- 创建新组件 `SplitToggleComponent`。
- 成员变量：两个 `Attachment` (分别对应 AutoGain 和 SoftClip 参数)。
- `paint`：使用 `g.reduceClipRegion` 或 `Path` 来分别填充两个三角形区域。

---

## 任务 3：仿 Web 版预设顶栏 (Web-Style Header)

**目标**：重构插件顶部的 Header 区域，使其与 Web 版一致。
**设计**：
- 移除：旧的 `juce::ComboBox` 预设选择器。
- 新增：
  - 左侧：[LOGO ICON] **SPLENTA** (Title)
  - 中间/右侧：[SAVE] [LOAD] [Preset Name Display]
  - 样式：纯文字按钮（TextButton 设为无边框），鼠标悬停高亮。字体使用 JetBrains Mono。

---

## 任务 4：全局字体与排版

**目标**：引入 JetBrains Mono 字体。
**执行**：
- 检查资源中是否有 `JetBrainsMono-Regular.ttf`。如果没有，请尝试使用 LookAndFeel 的 `setDefaultFont` 设置为系统等宽字体作为回退，或者提示用户添加资源。
- 将所有 Label、Button、Knob Value 的字体设置为该字体。

---

## 布局调整
- 将新的 `SplitToggleComponent` 放置在 "MASTER OUTPUT" 面板的空闲区域（原 AutoGain/SoftClip 的位置）。
- 确保所有新控件都正确绑定了 APVTS 参数。

## 检查清单
- [ ] Generator 面板现在是否显示为三个图形化的波形按钮？
- [ ] Master Output 面板是否有一个斜切的方形双开关？
- [ ] 点击斜切开关的左上和右下是否能分别控制两个参数？
- [ ] 顶部 Header 是否变成了 Web 版那种简洁的文字按钮样式？
