# SPLENTA UI Batch 07 & 07.5: Oscilloscope & Visual Contrast

你是 JUCE 图形与 DSP 交互专家。Batch 06 完成了自定义控件的结构，Batch 07 将注入灵魂：移植 Web 版的高级示波器视觉，并解决界面“灰暗不清”的对比度问题。

---

## Batch 07: 移植 Pro-C2 风格示波器 (Oscilloscope Port)

**目标**：将 Web 版 `components/Oscilloscope.tsx` 的视觉逻辑完全移植到 C++ `InputDetectorComponent`。
**核心功能**：这不仅仅是一条线，它是一个带有填充渐变、触发高亮区域的实时监视器。

**技术规范：**

1.  **数据结构 (Ring Buffer)**:
    - 维护一个 `std::vector<float>` 或 `AudioBuffer` 作为环形缓冲区，存储最近 N 帧的振幅（dB）。
    - 这是一个“滚动”视图，不需要重绘每一帧的全部历史，但在 `paint` 中需要遍历缓冲区来生成 Path。

2.  **绘制层级 (Paint Steps)**:
    - **Step 1: Grid**: 绘制 -12, -24, -36, -48 dB 的水平参考线 (颜色 `white.withAlpha(0.05f)`).
    - **Step 2: Gradient Fill (重点)**:
        - 创建一个 `juce::Path`，连接缓冲区内的所有点。
        - 将 Path 的底部闭合到视图底边。
        - 使用 `g.setGradientFill` 填充该 Path。
        - **渐变色**: 顶部为 `accentColor.withAlpha(0.5f)`，底部为 `accentColor.withAlpha(0.05f)`。
    - **Step 3: Stroke Line**: 再次绘制波形顶部的线条 (实心 `accentColor`, 2px)。
    - **Step 4: Trigger Highlight (红区)**:
        - 计算波形中 **高于 Threshold** 的部分。
        - 在这些区域叠加一层淡淡的红色 `Colours::red.withAlpha(0.2f)`，表示“正在发生处理”。(Web 版中的 Clip 遮罩逻辑)。
    - **Step 5: Reference Lines**:
        - 绘制 Ceiling (实线红) 和 Threshold (虚线白)。

3.  **交互**:
    - 暂时不需要鼠标交互，纯视觉展示。

---

## Batch 07.5: 旋钮材质与对比度优化 (Knob Contrast)

**问题**：当前 C++ 版本的旋钮颜色与面板背景过于接近，缺乏 Web 版的立体感和层次感。
**目标**：调整 `LookAndFeel` 中的旋钮绘制逻辑，增加明度对比和阴影。

**配色映射 (Web -> JUCE):**
- **Panel Background**: `0xFF140C08` (极深)
- **Knob Body (New)**: `0xFF331D14` (Bronze-800) —— **关键点**：它必须比背景亮！
- **Knob Border**: `0xFF4A2B1D` (Bronze-700) —— 1px 的高亮边框。
- **Shadow**: `DropShadow(Colours::black.withAlpha(0.5f), 4, 0)` —— 让旋钮浮起来。

**执行动作 (修改 LookAndFeel):**

1.  **drawRotarySlider**:
    - 不要只画一个圆。画三个层级：
        1.  **Shadow**: 绘制一个带模糊的黑色圆在下方。
        2.  **Body**: 使用 `currentPalette.knobBody` (需在 Theme 中定义，对应 Bronze-800) 填充圆形。
        3.  **Border**: 使用 `currentPalette.knobBorder` (对应 Bronze-700) 描边 1px。
    - **Indicator Dot**:
        - 激活/拖拽状态：亮色 (Accent)。
        - 非激活状态：灰色 (或者暗淡的 Accent)，不要完全黑掉。

2.  **Split Toggle (Batch 06 遗留优化)**:
    - 确保那个斜切方块的背景色也比面板背景稍亮，遵循同样的“实体层级”逻辑。

---

## 检查清单
- [ ] 示波器是否有漂亮的渐变填充？(而不是只有一条线)
- [ ] 当波形超过 Threshold 线时，超过的部分是否有红色的高亮叠加？
- [ ] 旋钮看起来是“浮”在面板上的吗？(是否有阴影和明度差)
- [ ] 旋钮的边缘是否清晰可见？
