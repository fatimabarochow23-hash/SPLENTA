20251127.02 æ›´æ–°æç¤ºè¯å¦‚ä¸‹
# ğŸš€ ä»»åŠ¡ï¼šSPLENTA è§†è§‰ä¸äº¤äº’é‡æ„ (V19.0 - Sniper & Cinematic Update)

Claudeï¼Œæˆ‘æ˜¯æŠ€æœ¯è´Ÿè´£äººã€‚è¿™æ˜¯ V19.0 çš„æœ€ç»ˆæ‰§è¡ŒæŒ‡ä»¤ã€‚
å·¥ç¨‹è·¯å¾„ï¼š/Users/MediaStorm/Desktop/NewProject/Source/ï¿¼

## ğŸ¯ ç›®æ ‡æ¦‚è¿°
æˆ‘ä»¬éœ€è¦è§£å†³ UI å‰²è£‚ã€æ»šåŠ¨è¿‡å¿«ã€äº¤äº’å›°éš¾ç­‰é—®é¢˜ï¼Œå¹¶å¼•å…¥ç‹¬ç‰¹çš„ "Sniper Scope" è§†è§‰åé¦ˆã€‚
**æ ¸å¿ƒåŸåˆ™ï¼š** ä¸“ä¸šçš„è§†è§‰ç¾æ„Ÿã€ä¸æ»‘çš„åŠ¨ç”»ç‰©ç†ã€ç›´è§‚çš„å‚æ•°åé¦ˆã€‚

---

## 1. è§†è§‰ä¸ä¸»é¢˜ç»Ÿä¸€ (Theme Integration)
**é—®é¢˜ï¼š** `EnvelopeView` çš„é¢œè‰²ç›®å‰æ˜¯ç¡¬ç¼–ç çš„ï¼Œä¸è·Ÿéšä¸»ç•Œé¢çš„ Theme åˆ‡æ¢ã€‚
**æ‰§è¡Œï¼š**
1.  **ä¿®æ”¹ `EnvelopeView.h/cpp`ï¼š** æ·»åŠ  `setThemeColors(Colour bg, Colour detector, Colour synth, Colour output, Colour grid)` æ–¹æ³•ã€‚
2.  **ä¿®æ”¹ `PluginEditor.cpp`ï¼š** åœ¨ `updateColors()` æ–¹æ³•ä¸­ï¼Œè·å–å½“å‰ä¸»é¢˜çš„é…è‰²ï¼Œå¹¶è°ƒç”¨ `envelopeView.setThemeColors(...)`ã€‚
    * *è§„åˆ™ï¼š* Synth é¢œè‰²å¿…é¡»ä¸ä¸»è‰²è°ƒ (Accent Color) ä¸€è‡´ã€‚Detector å’Œ Output é¢œè‰²æ ¹æ® Accent è®¡ç®—äº’è¡¥è‰²æˆ–åŒè‰²ç³»å˜ä½“ã€‚
    * *èƒŒæ™¯ï¼š* å¿…é¡»å®Œå…¨é€æ˜æˆ–ä¸ `PluginEditor` èƒŒæ™¯èåˆï¼Œæ¶ˆé™¤å‰²è£‚æ„Ÿã€‚

## 2. æ»šåŠ¨ç‰©ç†ä¼˜åŒ– (Cinematic Scroll)
**é—®é¢˜ï¼š** å½“å‰æ»šåŠ¨é€Ÿåº¦æå¿«ï¼ˆäº§ç”ŸåŠ¨æ€æ¨¡ç³Šï¼‰ï¼Œä¸”éŸ³é¢‘åœæ­¢åæ³¢å½¢ä¸ä¼šæ¶ˆå¤±ï¼ˆä¸å½’é›¶ï¼‰ã€‚
**æ‰§è¡Œï¼š**
1.  **é™é‡‡æ ·ç‡è°ƒæ•´ (PluginProcessor.h)ï¼š**
    * å°† `envUpdateRate` ä» `64` å¢åŠ åˆ° **`256`**ã€‚
    * *åŸç†ï¼š* 48kHz / 256 â‰ˆ 187Hz æ•°æ®ç‡ã€‚åœ¨ 60Hz UI åˆ·æ–°ä¸‹ï¼Œæ¯å¸§ç§»åŠ¨çº¦ 3 åƒç´ ã€‚è¿™å°†äº§ç”Ÿç¼“æ…¢ã€ç”µå½±æ„Ÿçš„æ»šåŠ¨æ•ˆæœï¼Œè€Œä¸æ˜¯ç°åœ¨çš„â€œé£é€Ÿâ€æ•ˆæœã€‚
2.  **æ·¡å‡ºé€»è¾‘ (EnvelopeView.cpp)ï¼š**
    * åœ¨ `timerCallback` ä¸­æ·»åŠ â€œä¿¡å·è¡°å‡â€é€»è¾‘ã€‚
    * **é€»è¾‘ï¼š** å¦‚æœ FIFO ä¸­æ²¡æœ‰æ–°æ•°æ®ï¼ˆæˆ–æ•°æ®æå°ï¼‰ï¼Œä¸”æœªå¤„äº Freeze çŠ¶æ€ï¼Œåˆ™å¯¹ `historyBuffer` ä¸­çš„æ‰€æœ‰ç‚¹åº”ç”¨è¡°å‡ç³»æ•°ï¼ˆä¾‹å¦‚ `val *= 0.96f`ï¼‰ã€‚
    * *æ•ˆæœï¼š* å£°éŸ³åœæ­¢åï¼Œæ³¢å½¢ä¼šä¼˜é›…åœ°å‘ä¸‹æ»‘è½/æ·¡å‡ºï¼Œè€Œä¸æ˜¯åƒµæ­»åœ¨å±å¹•ä¸Šã€‚
3.  **Freeze åŠŸèƒ½ï¼š**
    * åœ¨ UI ä¸Šæ·»åŠ ä¸€ä¸ªå°çš„ `[F]` (Freeze) æŒ‰é’®ã€‚å½“æ¿€æ´»æ—¶ï¼Œæš‚åœ `timerCallback` ä¸­çš„å†å²æ•°æ®æ›´æ–°å’Œè¡°å‡é€»è¾‘ã€‚

## 3. UI äº¤äº’ç»„ä»¶é‡æ„
**é—®é¢˜ï¼š** æ‰©å±•æŒ‰é’®å¤ªå°ï¼›å‚è€ƒçº¿ (T/C) ä¸‘é™‹ï¼›ç¼ºå°‘ä¸“ä¸šæ„Ÿã€‚
**æ‰§è¡Œï¼š**
1.  **åœ†å½¢æ‰©å±•æŒ‰é’® (PluginEditor.cpp)ï¼š**
    * é‡ç»˜ `expandButton`ã€‚ä½¿ç”¨ `drawEllipse` ç»˜åˆ¶åœ†å½¢èƒŒæ™¯ã€‚
    * åœ¨åœ†åœˆä¸­å¿ƒç»˜åˆ¶åŠ ç²—çš„ç®­å¤´ï¼ˆ`juce::Path`ï¼‰ã€‚
    * *å°ºå¯¸ï¼š* è‡³å°‘ 24x24 åƒç´ ï¼Œç¡®ä¿å®¹æ˜“ç‚¹å‡»ã€‚
2.  **å‚è€ƒçº¿ç¾åŒ– (EnvelopeView.cpp)ï¼š**
    * **ç§»é™¤è™šçº¿ï¼š** Threshold å’Œ Ceiling çº¿å…¨éƒ¨æ”¹ä¸º**ç»†å®çº¿** (1.0f)ã€‚
    * **ç§»é™¤æ¢¯å½¢æ ‡ç­¾ï¼š** åˆ é™¤ C/T å­—æ¯å‘¨å›´çš„æ¢¯å½¢/æ–¹æ¡†èƒŒæ™¯ã€‚
    * **æ ·å¼ï¼š** ä»…åœ¨å·¦ä¾§è¾¹ç¼˜æ˜¾ç¤ºæå°çš„ã€ç²¾è‡´çš„æ–‡å­— "THR" å’Œ "CEIL" (å­—ä½“å¤§å° 10px, Opacity 0.6)ã€‚
    * **é¢œè‰²ï¼š** ä½¿ç”¨åŠé€æ˜çš„ç™½è‰²æˆ–ç°è‰²ï¼Œä¸è¦ä½¿ç”¨æ‰çœ¼çš„é’è‰²ï¼Œé™¤éå®ƒæ˜¯å½“å‰ Theme çš„å¼ºè°ƒè‰²ã€‚

## 4. æ–°åŠŸèƒ½ï¼šç‹™å‡»é•œ (Sniper Scope)
**éœ€æ±‚ï¼š** å½“ FFT è¢«æŠ˜å ï¼ˆEnvelopeView å æ®å…¨å®½ï¼‰æ—¶ï¼Œæ˜¾ç¤º Release å‚æ•°çš„å¯è§†åŒ–ã€‚
**å®ç°é€»è¾‘ (EnvelopeView.cpp::paint)ï¼š**
1.  **æ¡ä»¶ï¼š** ä»…å½“ `!showFFT` (å³ View å®½åº¦è¾ƒå¤§) æ—¶ç»˜åˆ¶ã€‚
2.  **å½¢æ€ï¼š** ç»˜åˆ¶ä¸€å¯¹æ‹¬å¼§ `(   )` ä½äºè§†å›¾ä¸­å¿ƒæˆ– Trigger çº¿é™„è¿‘ã€‚
    * ä½¿ç”¨ `juce::Path` ç»˜åˆ¶å¹³æ»‘çš„æ›²çº¿æ‹¬å¼§ã€‚
    * **é£æ ¼ï¼š** ç±»ä¼¼ç›¸æœºçš„å¯¹ç„¦æ¡†æˆ–ç‹™å‡»é•œåˆ»åº¦ã€‚
3.  **åŠ¨æ€å“åº”ï¼š**
    * è·å– `DET_REL` (Release) å‚æ•°å€¼ã€‚
    * **æ˜ å°„ï¼š** `gapWidth = map(releaseMs, minMs, maxMs, minPx, maxPx)`ã€‚
    * *Min:* å³ä½¿ Release æœ€å°ï¼Œæ‹¬å¼§ä¹Ÿä¸é‡å ï¼Œå½¢æˆä¸€ä¸ªè¿‘ä¼¼åœ†ç¯ `()`ã€‚
    * *Max:* Release æœ€å¤§æ—¶ï¼Œæ‹¬å¼§å±•å¼€ï¼Œå æ®çº¦ 1/3 å±å¹•å®½åº¦ã€‚
4.  **äº¤äº’ï¼š** è°ƒèŠ‚ Release æ—‹é’®æ—¶ï¼Œç”¨æˆ·èƒ½ç›´è§‚çœ‹åˆ°æ‹¬å¼§çš„å¼€åˆåŠ¨ç”»ã€‚

## 5. DSP ä¿¡å·å¤„ç†ä¿®æ­£
**é—®é¢˜ï¼š** Soft Clip é€»è¾‘è½¯ç»µï¼›Auto-Gain é€»è¾‘å¯¼è‡´éŸ³é‡è¿‡å¤§ã€‚
**æ‰§è¡Œ (PluginProcessor.cpp)ï¼š**
1.  **Soft Clip æ”¹ä¸º Hard Limiterï¼š**
    * åºŸå¼ƒ `std::tanh`ã€‚
    * **å®ç° Pro-L2 é£æ ¼é™åˆ¶ï¼š**
        ```cpp
        // ç¡¬é™åˆ¶åœ¨ -0.01dB
        float limit = juce::Decibels::decibelsToGain(-0.01f);
        if (mixed > limit) mixed = limit;
        else if (mixed < -limit) mixed = -limit;
        // ç®€å•çš„è‡ªåŠ¨è¡¥å¿ (å¯é€‰ï¼Œå¦‚æœç”¨æˆ·è§‰å¾—å£°éŸ³å˜å°äº†)
        // ä½†ç›®å‰å…ˆä¿æŒçº¯ç²¹çš„ Limiter ä»¥é˜²æ­¢è¿‡è½½ã€‚
        ```
2.  **Auto-Gain ä¿®æ­£ï¼š**
    * ç°åœ¨çš„é€»è¾‘æ˜¯ `InputRMS / OutputRMS`ã€‚å¦‚æœ Output å¾ˆå°ï¼ˆæ¯”å¦‚ Ducking å¯¼è‡´ï¼‰ï¼ŒGain ä¼šçŒ›å¢ã€‚
    * **ä¿®æ­£ï¼š** æ·»åŠ ä¿æŠ¤é™åˆ¶ã€‚æœ€å¤§å¢ç›Šè¡¥å¿ä¸è¶…è¿‡ +6dBã€‚å¦‚æœ OutputRMS < -60dBï¼Œä¸è¿›è¡Œå¢ç›Šè®¡ç®—ï¼ˆé˜²æ­¢é™¤ä»¥é›¶æˆ–å™ªéŸ³çˆ†ç‚¸ï¼‰ã€‚

---

## ğŸ› ï¸ æ–‡ä»¶ä¿®æ”¹æ¸…å•
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹ä»£ç ï¼š

1.  **PluginProcessor.h/cpp:**
    * ä¿®æ”¹ `envUpdateRate` ä¸º 256ã€‚
    * é‡å†™ `processBlock` ä¸­çš„ Soft Clip é€»è¾‘ (Hard Limit)ã€‚
    * ä¿®æ­£ AGM (Auto Gain) çš„å®‰å…¨é˜ˆå€¼ã€‚

2.  **EnvelopeView.h/cpp:**
    * æ·»åŠ  `setThemeColors(...)`ã€‚
    * æ·»åŠ  `drawSniperScope(...)` ç§æœ‰æ–¹æ³•ã€‚
    * åœ¨ `timerCallback` ä¸­å®ç°æ•°æ®è¡°å‡ (Decay)ã€‚
    * åœ¨ `paint` ä¸­é‡ç»˜ T/C å‚è€ƒçº¿ (ç®€çº¦é£æ ¼)ã€‚
    * åœ¨ `paint` ä¸­æ ¹æ® `showFFT` çŠ¶æ€å†³å®šæ˜¯å¦ç»˜åˆ¶ Sniper Scopeã€‚

3.  **PluginEditor.h/cpp:**
    * é‡ç»˜ `expandButton` (åœ†å½¢ + ç®­å¤´)ã€‚
    * åœ¨ `updateColors` ä¸­å°†é¢œè‰²ä¼ é€’ç»™ `envelopeView`ã€‚
    * æ·»åŠ  Freeze æŒ‰é’® (å¯é€‰ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿä¼˜å…ˆä¿è¯æ‰©å±•æŒ‰é’®æ˜“ç”¨æ€§)ã€‚

## ğŸš€ æ‰§è¡ŒæŒ‡ä»¤
è¯·è¯»å–å½“å‰æ‰€æœ‰ä»£ç ï¼Œæ ¹æ®ä¸Šè¿° V19.0 è§„èŒƒè¿›è¡Œé‡æ„ã€‚ä¿æŒä»£ç æ•´æ´ï¼Œ**ä¸è¦**è§£é‡Šæ¯ä¸€è¡Œä¿®æ”¹ï¼Œç›´æ¥è¾“å‡ºä¿®æ”¹åçš„å®Œæ•´æ–‡ä»¶ä»£ç å—ã€‚ä¼˜å…ˆå¤„ç† EnvelopeView çš„è§†è§‰å¤§ä¿®ã€‚
